<!doctype html>
<title>Debian</title>

<script src="../build/libv86.js"></script>
<script>
    "use strict";
    window.onload = function () {
        const container1 = document.getElementById("screen_container1");
        const container2 = document.getElementById("screen_container2");

        var emulator1 = new V86({
            wasm_path: "../build/v86.wasm",
            memory_size: 1024 * 1024 * 1024,
            vga_memory_size: 8 * 1024 * 1024,
            screen_container: container1,
            initial_state: { url: "../images/debian-state-base.bin.zst" },
            filesystem: {
                baseurl: "../images/debian-9p-rootfs-flat/",
                basefs: "../images/debian-base-fs.json",
            },
            autostart: true,
        });

        var emulator2 = new V86({
            wasm_path: "../build/v86.wasm",
            memory_size: 1024 * 1024 * 1024,
            vga_memory_size: 8 * 1024 * 1024,
            screen_container: container2,
            // initial_state: { url: "../images/debian-state-base.bin.zst" },
            filesystem: {
                baseurl: "../images/debian-9p-rootfs-flat/",
                basefs: "../images/debian-base-fs.json",
            },
            autostart: true,
            bios: { url: "../bios/seabios.bin" },
            vga_bios: { url: "../bios/vgabios.bin" },
            bzimage_initrd_from_filesystem: true,
            cmdline: "rw root=host9p rootfstype=9p rootflags=trans=virtio,cache=loose modules=virtio_pci tsc=reliable init=/bin/bash",
        });

        emulator2.keyboard_set_status(false);

        container1.addEventListener("mousedown", function (e) {
            container1.style.borderColor = "yellow";
            container2.style.borderColor = "black";

            emulator1.keyboard_set_status(true);
            emulator2.keyboard_set_status(false);
        }, false);

        container2.addEventListener("mousedown", function (e) {
            container1.style.borderColor = "black";
            container2.style.borderColor = "yellow";

            emulator1.keyboard_set_status(false);
            emulator2.keyboard_set_status(true);
        }, false);

        emulator1.add_listener("serial0-output-byte", function (byte) {
            var char = String.fromCharCode(byte);
            emulator2.serial0_send(char);
        });
        emulator1.add_listener("net0-send", function (data) {
            emulator2.bus.send("net0-receive", data);
        });
        emulator2.add_listener("net0-send", function (data) {
            emulator1.bus.send("net0-receive", data);
        });
    };
</script>

<!-- A minimal structure for the ScreenAdapter defined in browser/screen.js -->
<div id="screen_container1" style="float: left; margin: 10px; border: 3px solid yellow;">
    <div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
    <canvas style="display: none"></canvas>
</div>

<div id="screen_container2" style="float: left; margin: 10px; border: 3px solid black;">
    <div style="white-space: pre; font: 14px monospace; line-height: 14px"></div>
    <canvas style="display: none"></canvas>
</div>